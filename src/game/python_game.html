<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Python Quest — Learning Game</title>  
  <!-- Tailwind CSS for utility classes used in nav and layout -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    html,body { height:100%; margin:0; font-family:Segoe UI,Roboto,Arial; }
    body { background:#0f172a; color:#e6eef8; }
    #gameWrap { display:flex; gap:12px; padding:12px; box-sizing:border-box; justify-content:center; max-width: 1200px; margin: 0 auto; }
    #viewport { background:#071028; border-radius:8px; box-shadow:0 6px 20px rgba(2,6,23,.6); }
    canvas { display:block; background:#8fbcd4; border-radius:6px; }
    #hud { width:320px; min-width:240px; background:#021224; border-radius:8px; padding:12px; box-sizing:border-box; }
    h1 { font-size:18px; margin:0 0 8px 0; color:#dbeefe; }
    #collected { margin-top:8px; display:flex; flex-direction:column; gap:6px; }
    .chip { background:#082234; padding:6px 8px; border-radius:6px; color:#bfe7ff; display:flex; justify-content:space-between; align-items:center; }
    #msg { margin-top:12px; background:#062434; padding:8px; border-radius:6px; min-height:66px; color:#cfefff; }
    #controls { margin-top:12px; display:flex; gap:8px; }
    button { background:#0a5b99; color:white; border:0; padding:8px 10px; border-radius:6px; cursor:pointer; }
    .small { font-size:13px; opacity:.9; }
    .disabled { opacity:.5; pointer-events:none; }
    #legend { margin-top:12px; font-size:13px; color:#b9dff5; }
    .tile-legend { display:flex; gap:8px; align-items:center; margin-top:6px; }
    .swatch { width:20px; height:16px; border-radius:3px; box-shadow:inset 0 -2px 0 rgba(0,0,0,.15); }
    footer { margin-top:14px; font-size:12px; color:#9fcbe8; opacity:.9; }

    /* lesson modal */
    #lessonModal { position:fixed; inset:0; display:flex; align-items:center; justify-content:center; background:rgba(2,6,23,0.7); z-index:50; visibility:hidden; opacity:0; transition:opacity .15s; }
    #lessonModal.open { visibility:visible; opacity:1; }
    #lessonCard { width:880px; max-width:calc(100% - 40px); background:#0b2230; border-radius:10px; padding:16px; box-sizing:border-box; color:#e6f7ff; display:grid; grid-template-columns:1fr 380px; gap:12px; }
    #lessonLeft { display:flex; flex-direction:column; gap:8px; }
    #lessonTitle { font-size:18px; margin:0; }
    #lessonDesc { font-size:14px; color:#cfefff; }
    #lessonEditor { width:100%; height:320px; background:#001826; color:#dff6ff; border-radius:6px; padding:8px; box-sizing:border-box; font-family:monospace; font-size:13px; resize:vertical; }
    #lessonRight { display:flex; flex-direction:column; gap:8px; }
    #lessonOutput { background:#021c26; color:#bfe7ff; padding:8px; height:180px; overflow:auto; border-radius:6px; font-family:monospace; font-size:13px; }
    .lessonButtons { display:flex; gap:8px; margin-top:6px; }
    .btn-secondary { background:#145a7a; }
  </style>
</head>
<body class="font-sans p-6">
  <nav class="bg-blue shadow-lg rounded-full px-6 py-3 mb-6 flex justify-center space-x-4">
        <a href="../index.html" class="text-white-700 font-semibold hover:text-blue-600 transition-colors duration-200">Home</a>
        <a href="../game/python_game.html" class="text-white-700 font-semibold hover:text-blue-600 transition-colors duration-200">Game</a>
        <div class="relative">
            <button id="lessons-button" class="text-white-700 font-semibold hover:text-blue-600 transition-colors duration-200 focus:outline-none">
                Drone Basics
            </button>
            <div id="lessons-dropdown" class="absolute hidden bg-white shadow-lg rounded-xl p-2 w-48 mt-2 z-10">
                <a href="../lessons/agriculture.html" class="block px-4 py-2 text-gray-700 hover:bg-gray-200 rounded-lg">Agriculture</a>
                <a href="../lessons/construction.html" class="block px-4 py-2 text-gray-700 hover:bg-gray-200 rounded-lg">Construction</a>
                <a href="../lessons/realEstate.html" class="block px-4 py-2 text-gray-700 hover:bg-gray-200 rounded-lg">Real Estate</a>
                <a href="../lessons/filmMaking.html" class="block px-4 py-2 text-gray-700 hover:bg-gray-200 rounded-lg">Filmmaking</a>
                <a href="../lessons/publicSafety.html" class="block px-4 py-2 text-gray-700 hover:bg-gray-200 rounded-lg">Public Safety</a>
                <a href="../lessons/surveyingMapping.html" class="block px-4 py-2 text-gray-700 hover:bg-gray-200 rounded-lg">Surveying and Mapping</a>
                <a href="../lessons/energyUtilities.html" class="block px-4 py-2 text-gray-700 hover:bg-gray-200 rounded-lg">Energy and Utilities</a>
                <a href="../lessons/logisticsDelivery.html" class="block px-4 py-2 text-gray-700 hover:bg-gray-200 rounded-lg">Logistics and Delivery</a>
                <a href="../lessons/journalism.html" class="block px-4 py-2 text-gray-700 hover:bg-gray-200 rounded-lg">Journalism</a>
                <a href="../lessons/environmentalConservation.html" class="block px-4 py-2 text-gray-700 hover:bg-gray-200 rounded-lg">Environmental Conservation</a>
            </div>
        </div>
        <div class="relative">
            <button id="part107-button" class="text-white-700 font-semibold hover:text-blue-600 transition-colors duration-200 focus:outline-none">
                Part 107 Study Guide
            </button>
            <div id="part107-dropdown" class="absolute hidden bg-white shadow-lg rounded-xl p-2 w-48 mt-2 z-10">
                <a href="../part107/part107.html" class="block px-4 py-2 text-gray-700 hover:bg-gray-200 rounded-lg">Introduction</a>
                <a href="../part107/regulations.html" class="block px-4 py-2 text-gray-700 hover:bg-gray-200 rounded-lg">Regulations</a>
                <a href="../part107/airspace.html" class="block px-4 py-2 text-gray-700 hover:bg-gray-200 rounded-lg">Airspace & Requirements</a>
                <a href="../part107/weather.html" class="block px-4 py-2 text-gray-700 hover:bg-gray-200 rounded-lg">Weather</a>
                <a href="../part107/loading.html" class="block px-4 py-2 text-gray-700 hover:bg-gray-200 rounded-lg">Loading & Performance</a>
                <a href="../part107/operations.html" class="block px-4 py-2 text-gray-700 hover:bg-gray-200 rounded-lg">Operations</a>
            </div>
        </div>
    </nav>
  
  <div id="gameWrap">
    <div id="viewport">
      <canvas id="gameCanvas" width="832" height="832" aria-label="Python Quest gameplay area">Your browser does not support canvas.</canvas>
    </div>

    <aside id="hud">
      <h1>Python Quest</h1>
      <div class="small">Collect snippets to learn Python basics and use them to beat bosses.</div>

      <div id="collected">
        <!-- chips inserted here -->
      </div>

      <div id="msg">Use arrow keys or WASD to move. Find "print", "variables", "strings", "numbers".</div>

      <div id="controls">
        <button id="nextBtn" type="button">Next Tip</button>
        <button id="resetBtn" type="button">Reset</button>
        <button id="backMainBtn" type="button" onclick="location.href='../../index.html'">Back to Main</button>
      </div>

      <div id="legend">
        <div class="small">Legend</div>
        <canvas id="minimap" width="200" height="200" class="mt-4 rounded bg-black border" aria-label="Level minimap">Your browser does not support canvas.</canvas>
        <div class="tile-legend"><div class="swatch" style="background:#3b82f6"></div><div>Player</div></div>
        <div class="tile-legend"><div class="swatch" style="background:#fde68a"></div><div>Collectible</div></div>
        <div class="tile-legend"><div class="swatch" style="background:#ef4444"></div><div>Boss/Goal</div></div>
        <div class="tile-legend"><div class="swatch" style="background:#0f172a"></div><div>Wall</div></div>
      </div>

      <footer>Designed for grades 3–6. Simple, visual, and fun.</footer>
    </aside>
  </div>

  <!-- Lesson modal (hidden by default) -->
  <div id="lessonModal" role="dialog" aria-hidden="true">
    <div id="lessonCard" role="document">
      <div id="lessonLeft">
        <h2 id="lessonTitle">Lesson</h2>
        <div id="lessonDesc">Description</div>
        <textarea id="lessonEditor" spellcheck="false"># Type Python here
print("hello world")</textarea>
        <div class="lessonButtons">
          <button id="runLessonBtn" type="button">Run</button>
          <button id="exampleBtn" type="button" class="btn-secondary">Load Example</button>
          <button id="completeLessonBtn" type="button" class="btn-secondary">Complete & Collect</button>
          <button id="closeLessonBtn" type="button" class="btn-secondary">Close</button>
        </div>
      </div>
      <div id="lessonRight">
        <div style="font-weight:600">Output</div>
        <div id="lessonOutput"></div>
        <div style="font-weight:600">Tip</div>
        <div id="lessonTip" style="color:#bfe7ff">Try running the code to see results. When you understand, press "Complete & Collect".</div>
      </div>
    </div>
  </div>

  <!-- Skulpt (run Python in-browser) -->
  <script src="https://cdn.jsdelivr.net/npm/skulpt@1.2.0/dist/skulpt.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/skulpt@1.2.0/dist/skulpt-stdlib.js"></script>

  <script src="./map.js"></script>
  <script src="./python_game.js"></script>
  <script>
    // Accessible dropdown toggles with single outside-click handler
    const lessonsBtn = document.getElementById('lessons-button');
    const lessonsMenu = document.getElementById('lessons-dropdown');
    const p107Btn = document.getElementById('part107-button');
    const p107Menu = document.getElementById('part107-dropdown');

    function toggleMenu(btn, menu) {
      const isHidden = menu.classList.toggle('hidden');
      btn.setAttribute('aria-expanded', String(!isHidden));
    }

    lessonsBtn.setAttribute('aria-haspopup', 'true');
    lessonsBtn.setAttribute('aria-expanded', 'false');
    lessonsBtn.setAttribute('aria-controls', 'lessons-dropdown');

    p107Btn.setAttribute('aria-haspopup', 'true');
    p107Btn.setAttribute('aria-expanded', 'false');
    p107Btn.setAttribute('aria-controls', 'part107-dropdown');

    lessonsBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      toggleMenu(lessonsBtn, lessonsMenu);
      // ensure the other menu closes
      p107Menu.classList.add('hidden');
      p107Btn.setAttribute('aria-expanded', 'false');
    });

    p107Btn.addEventListener('click', (e) => {
      e.stopPropagation();
      toggleMenu(p107Btn, p107Menu);
      lessonsMenu.classList.add('hidden');
      lessonsBtn.setAttribute('aria-expanded', 'false');
    });

    document.addEventListener('click', (event) => {
      if (!lessonsMenu.contains(event.target) && !lessonsBtn.contains(event.target)) {
        lessonsMenu.classList.add('hidden');
        lessonsBtn.setAttribute('aria-expanded', 'false');
      }
      if (!p107Menu.contains(event.target) && !p107Btn.contains(event.target)) {
        p107Menu.classList.add('hidden');
        p107Btn.setAttribute('aria-expanded', 'false');
      }
    });
  </script>
</body>
</html>